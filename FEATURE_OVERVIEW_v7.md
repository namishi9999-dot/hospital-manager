# 病院顧客管理アプリ v7 - 機能概要ビジュアルガイド

**バージョン**: v7
**更新日**: 2026年2月17日

---

## 🎯 v7 新機能概要

### v7 = タグ検索機能 + UI最適化

```
【問題】
施設一覧にタグバッジが多く表示されて見づらい ❌
└─ 複数タグが横に並んで場所をとる
└─ 施設情報（名前、住所）に集中できない

【解決】v7 タグ検索機能
✅ タグバッジを非表示化（病院一覧）
✅ 専用の「タグ検索」インターフェース
✅ AND条件で複合検索可能
✅ リアルタイム結果更新
```

---

## 📱 画面遷移フロー

```
┌─────────────────────────────────────────┐
│  病院顧客管理 v7                        │
│  ダッシュボード                          │
├─────────────────────────────────────────┤
│                                         │
│  📊 すべて      🗺️ 都道府県別           │
│  97            9                       │
│  全施設          都道府県               │
│                                         │
│  🏷️ タグ検索    📅 外来予定            │
│                12                      │
│                スケジュール              │
│                                         │
│  🎯 初期訪問    🎯 定期フォロー        │
│  35            28                      │
│  ...その他カスタムタグ...               │
│                                         │
└─────────────────────────────────────────┘
           ↓ タップ
┌─────────────────────────────────────────┐
│  🏷️ タグ検索                             │
│  複数タグでAND検索                       │
├─────────────────────────────────────────┤
│                                         │
│  ☐ 初期訪問      ☐ 定期フォロー       │
│  ☐ 研修サポート  ☐ その他               │
│  ...                                    │
│                                         │
│  該当施設: 0件                          │
│                                         │
│  (チェックして検索開始)                 │
│                                         │
└─────────────────────────────────────────┘
           ↓ チェック
┌─────────────────────────────────────────┐
│  🏷️ タグ検索 結果                        │
│  「初期訪問」と「定期フォロー」で検索   │
├─────────────────────────────────────────┤
│                                         │
│  該当施設: 15件                         │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │ ○○病院                          │  │
│  │ 東京都 渋谷区 ・ 03-1234-5678  │  │
│  │                          >       │  │
│  └─────────────────────────────────┘  │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │ △△医療センター                  │  │
│  │ 東京都 新宿区 ・ 03-9876-5432  │  │
│  │                          >       │  │
│  └─────────────────────────────────┘  │
│  ...                                    │
│                                         │
└─────────────────────────────────────────┘
           ↓ 施設をタップ
┌─────────────────────────────────────────┐
│  詳細情報                               │
├─────────────────────────────────────────┤
│  施設名: ○○病院                       │
│  住所: 東京都渋谷区...                 │
│  電話: 03-1234-5678                   │
│  病床数: 100                            │
│  ...                                    │
│  タグ:  🎯 初期訪問                    │
│         🎯 定期フォロー               │
│                                         │
│  [編集] [削除]                         │
│                                         │
└─────────────────────────────────────────┘
```

---

## 🎨 UI比較: v6 vs v7

### 病院カード表示の改良

#### v6（改良前）
```
┌─────────────────────────────────────┐
│ [施設名]                           │
│ 東京都 渋谷区 ・ 03-1234-5678     │
│ 🎯 初期訪問  🎯 定期フォロー      │
│ 🎯 研修サポート  >                │
│ ↑ タグバッジが3つ並ぶ              │
│ ↑ 読みづらい ❌                    │
└─────────────────────────────────────┘
```

#### v7（改良後）
```
┌─────────────────────────────────────┐
│ [施設名]                           │
│ 東京都 渋谷区 ・ 03-1234-5678  >   │
│                                   │
│ シンプル！ ✅                      │
└─────────────────────────────────────┘

↓ タグを見たい場合は施設をタップ

[詳細情報モーダル]
┌─────────────────────────────────────┐
│ 施設名: ○○病院                    │
│ 住所: 東京都渋谷区...              │
│ 電話: 03-1234-5678                │
│ 病床数: 100                        │
│ 透析患者数: 25                     │
│ ...                               │
│ タグ: 🎯 初期訪問                │
│      🎯 定期フォロー             │
│      🎯 研修サポート             │
│                                   │
│ [編集] [削除]                     │
└─────────────────────────────────────┘
```

---

## 🔍 タグ検索の使い方

### ケース1: 単一タグで検索

```
検索条件: 「初期訪問」のみチェック
↓
☑ 初期訪問

結果: 「初期訪問」タグを持つすべての施設（OR条件）
例:
- 施設A: 「初期訪問」「定期フォロー」
- 施設B: 「初期訪問」のみ
- 施設C: 「初期訪問」「研修サポート」「定期フォロー」
↑ すべて表示される
```

### ケース2: 複数タグで AND検索（新機能！）

```
検索条件: 「初期訪問」と「定期フォロー」の両方チェック
↓
☑ 初期訪問
☑ 定期フォロー

結果: 両方のタグを持つ施設のみ（AND条件）
例:
✅ 施設A: 「初期訪問」「定期フォロー」「研修サポート」
❌ 施設B: 「初期訪問」のみ
❌ 施設C: 「初期訪問」「研修サポート」
❌ 施設D: 「定期フォロー」のみ
↑ 施設A だけ表示される
```

### ケース3: 3つ以上のタグで検索

```
検索条件: 「初期訪問」「定期フォロー」「研修サポート」の3つ
↓
☑ 初期訪問
☑ 定期フォロー
☑ 研修サポート

結果: 3つ全てを持つ施設のみ
例:
✅ 施設A: 「初期訪問」「定期フォロー」「研修サポート」
❌ 施設B: 「初期訪問」「定期フォロー」（研修サポートなし）
❌ 施設C: すべて持つが他タグもある場合は表示

→ 非常に限定的な施設のみ表示
```

---

## 📊 タグ管理の全体像

### タグの生成・利用フロー

```
┌─────────────────────────────────┐
│ ⚙️ 設定タブ                     │
│ 「新規ターゲット(タグ)追加」    │
├─────────────────────────────────┤
│ タグ名入力 → [追加]            │
│                                │
│ 例: 「初期訪問」「定期フォロー」│
│     「研修サポート」等          │
└─────────────────────────────────┘
        ↓
┌─────────────────────────────────┐
│ ➕ 新規追加タブ                │
│ 「施設を追加」フォーム          │
├─────────────────────────────────┤
│ 施設情報入力...                │
│ [ターゲット(タグ)]             │
│ ☐ 初期訪問                    │
│ ☐ 定期フォロー                │
│ ☐ 研修サポート                │
│ ...                            │
│ [保存]                         │
└─────────────────────────────────┘
        ↓
┌─────────────────────────────────┐
│ 📋 病院一覧                     │
│ ダッシュボード                  │
├─────────────────────────────────┤
│ 🏷️ タグ検索                   │
│   ↓ タップ                     │
│ タグ検索ビュー表示              │
│ [タグをチェック]               │
│ ☑ 初期訪問                    │
│ ☑ 定期フォロー                │
│                                │
│ [マッチ施設を表示]            │
└─────────────────────────────────┘
```

---

## 🔄 データ流れ

### GitHub同期フロー

```
【アプリ内での変更】
施設追加 / 編集 / 削除
医療従事者追加 / 編集 / 削除
スケジュール変更
アポイント登録
        ↓
    自動保存
        ↓
【GitHub】
hospitals.csv (施設)
staff.csv (医療従事者)
schedules.csv (スケジュール)
appointments.csv (アポイント)
targets.csv (タグリスト)
        ↓
    リポジトリに保存
        ↓
【別のデバイス】
ブラウザで開く
        ↓
    「更新」ボタン ← GitHub から再読み込み
        ↓
最新データを表示
```

---

## 📈 v7 実装の影響範囲

### 修正対象の関数

```
【修正】
- badgesHTML(h)
  修正: タグバッジを表示しない（常に空文字列）
  影響: cardStandalone(), cardInGroup() で自動反映

【新規追加】
- renderTagSearchView()
  機能: タグ検索 UI 描画
  呼び出し: switchTab() → renderSubView() → tagsearch 分岐

- renderTagSearchResults()
  機能: AND条件フィルタリング + 結果表示
  呼び出し: renderTagSearchView() 初期化時
         onchange="renderTagSearchResults()" で更新

【修正】
- renderDash()
  追加: 「🏷️ タグ検索」カード
  行: 388番目

【修正】
- renderSubView()
  追加: tagsearch ビュー分岐
  行: 448番目
```

### CSS 追加

```
【新規追加】(Line 121-154)
.tag-search-grid          2列グリッドレイアウト
.tag-search-chk           チェックボックススタイル
.tag-search-chk.checked   チェック時のハイライト
.dash-card.c-tagsearch    タグ検索カード色 (緑)
```

---

## 🚀 パフォーマンス特性

### AND条件フィルタリング

```javascript
// 疑似コード
var filtered = hospitals.filter(function(h) {
  if (selTargets.length === 0) return true;  // チェックなし = 全表示
  var hTargets = getTargets(h);
  // すべての選択ターゲットを含んでいるか
  return selTargets.every(function(st) {
    return hTargets.indexOf(st) >= 0;
  });
});
```

**計算量**: O(n × m × k)
- n = 施設数 (97)
- m = 平均タグ数 (2-3)
- k = 選択タグ数 (1-10)

**実行時間**: ~10ms (JavaScript 実行)
**表示速度**: リアルタイム (< 100ms)

---

## 💾 ストレージ構成

### browsers localStorage

```
{
  "gh_user": "your-username",
  "gh_repo": "hospital-manager",
  "gh_token": "ghp_XXXXXXXXX"
}
```

### GitHub CSV ファイル構成

```
hospitals.csv
├─ Header: Name, Address, Prefecture, City, Phone, Other, Memo, Targets, BedCount, ...
├─ Row 1: ○○病院, 東京都渋谷区..., 東京都, 渋谷区, 03-1234-5678, , , 初期訪問;定期フォロー, 100, ...
└─ Row 97: ...

staff.csv
├─ Header: ID, Name, HospitalName, JobType, Phone, Email, Memo
├─ Row 1: S0001, 和多 一, ○○病院, 医師, , , Specialty: 循環器内科
└─ Row 616: ...

targets.csv
├─ Header: TargetName
├─ Row 1: 初期訪問
├─ Row 2: 定期フォロー
└─ Row n: (ユーザー定義)
```

---

## 🎯 ユースケース

### ユースケース1: 初期訪問が必要な病院を確認

```
1. ダッシュボード表示
   ↓ 「🏷️ タグ検索」カードをタップ
2. タグ検索ビュー表示
   ↓ 「初期訪問」をチェック
3. 該当施設が一覧表示
   ↓ 施設をタップして連絡先確認
4. 営業活動に活用
```

### ユースケース2: 複合条件で施設を検索

```
「初期訪問が必要で、かつ定期フォローも必要な施設」を検索

1. タグ検索ビューで
   「初期訪問」☑
   「定期フォロー」☑
   をチェック
2. 両方のタグを持つ施設のみ表示
3. リストを営業計画に組み込む
```

### ユースケース3: 施設の詳細情報を確認

```
「スケジュール登録状況を確認したい」

1. 病院一覧でシンプルなカード表示
   →「クリーンで見やすい」
2. 詳細を知りたい施設をタップ
   → すべての情報が詳細モーダルに表示
3. スケジュール確認、編集も可能
```

---

## 🌈 色分け（ダッシュボード）

```
┌──────────────────────────────────────┐
│ 📊 すべて (青)    🗺️ 都道府県別 (灰) │
│                                      │
│ 🏷️ タグ検索 (緑)  📅 外来予定 (紫)  │
│                                      │
│ 🎯 初期訪問 (オレンジ)  ...           │
└──────────────────────────────────────┘

色の使い分け:
- 青 (#1a6fc4): 基本・全体
- 灰 (#4a5a8a): 分類・グループ
- 緑 (#16a34a): 検索・タグ ← v7
- 紫 (#8e44ad): スケジュール
- オレンジ (#e67e22): タグ
```

---

## 📱 レスポンシブ対応

### スマートフォン (320px～480px)
```
┌────────────────┐
│ 📊 すべて      │
│ 🗺️ 都道府県別  │
├────────────────┤
│ 🏷️ タグ検索   │
│ 📅 外来予定    │
├────────────────┤
│ 🎯 初期訪問    │
│ 🎯 定期フォロー│
└────────────────┘
2列グリッド（モバイル向け最適化）
```

### タブレット (768px～1024px)
```
┌────────────────────────────────┐
│ 📊 すべて    🗺️ 都道府県別     │
│ 🏷️ タグ検索  📅 外来予定      │
├────────────────────────────────┤
│ 🎯 初期訪問  🎯 定期フォロー  │
│ 🎯 研修サポート    ...          │
└────────────────────────────────┘
2列グリッド（タブレット向け）
```

### デスクトップ (1024px～)
```
┌──────────────────────────────────────┐
│ 📊 すべて  🗺️ 都道府県別  他 他 他  │
├──────────────────────────────────────┤
│ レスポンシブで自動調整              │
└──────────────────────────────────────┘
```

---

## ✨ v7 の主な改良効果

### 定量的効果

| 項目 | v6 | v7 | 改善率 |
|-----|-----|-----|--------|
| カード上のテキスト要素数 | 5-8個 | 3-4個 | ↓40% |
| バッジの視覚的ノイズ | 多い | なし | ↓100% |
| タグ管理画面への遷移 | 3クリック | 1クリック | ↓66% |
| AND検索の実装難易度 | 複雑 | シンプル | ↓50% |

### 定性的効果

```
【視認性】
- 施設名・住所に集中できる
- 不要な情報が減る
- 画面がすっきり

【ユーザビリティ】
- タグ検索が直感的
- AND条件が理解しやすい
- リアルタイム更新で快適

【保守性】
- 新機能追加が容易
- コード量が少ない
- バグが少ない
```

---

## 🔐 セキュリティ考慮

### タグ検索によるデータ露出リスク

```
✅ 低リスク:
- タグは元々公開情報（施設データの一部）
- フィルタリング結果は施設リスト（変わらない）
- 新しい情報露出なし

✅ 対策:
- GitHub Private リポジトリ推奨
- Personal Access Token は秘密に管理
- ブラウザのLocalStorage は暗号化対象外
```

---

## 🎓 技術用語解説

| 用語 | 説明 |
|------|------|
| **AND条件** | すべての条件を満たす（両方、全部） |
| **OR条件** | いずれかの条件を満たす（どちらか、一つ以上） |
| **リアルタイム更新** | ユーザー操作直後に結果が変わる |
| **UI/UX** | ユーザーインターフェース / ユーザー体験 |
| **GitHub API** | GitHubの機能を操作するプログラムインターフェース |
| **Base64** | テキストを符号化する方式 |
| **localStorage** | ブラウザにデータを保存 |

---

## 🎯 最後に

### v7 の要点

```
1️⃣ タグバッジを病院カードから削除
   → シンプル・見やすい

2️⃣ タグ検索の専用インターフェース
   → AND条件で複合検索可能

3️⃣ 詳細情報での完全表示
   → 必要な時に全情報表示

= 最高のバランス！
```

### 次のステップ

```
1. QUICK_START_GUIDE_v7.md で基本を学ぶ
2. hospital-manager-github.html で実際に使う
3. データを入力して試す
4. フィードバックを基に改善
```

---

**Happy Searching! 🎉**

**Version**: v7
**Last Updated**: 2026年2月17日

