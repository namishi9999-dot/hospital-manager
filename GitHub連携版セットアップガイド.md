# 病院顧客管理システム - GitHub連携版セットアップガイド

## 🎯 このシステムでできること

- **PC・iPhone両対応**: 同じURLからアクセス
- **自動同期**: データがGitHub上で自動的に同期
- **オフライン対応**: インターネットがない場所でも閲覧可能
- **無料**: GitHub無料プランで利用可能

---

## 📋 セットアップ手順

### ステップ1: GitHubアカウントを作成

1. https://github.com にアクセス
2. **Sign up** をクリック
3. メールアドレス、パスワードを入力して登録（無料）

---

### ステップ2: 新しいリポジトリを作成

1. GitHubにログイン後、右上の **「+」** → **「New repository」**
2. 以下の設定:
   - **Repository name**: `hospital-manager`
   - **Public** を選択（GitHub Pagesに必要）
   - **Add a README file** にチェック
3. **Create repository** をクリック

---

### ステップ3: ファイルをアップロード

1. 作成したリポジトリのページで **Add file** → **Upload files**
2. 以下の6つのファイルをドラッグ&ドロップ:
   - `hospital-manager-github.html`
   - `hospitals.csv`
   - `staff.csv`
   - `targets.csv`
   - `jobtypes.csv`
   - `schedules.csv`
   - `appointments.csv`
3. **Commit changes** をクリック

---

### ステップ4: GitHub Pagesを有効化

1. リポジトリの **Settings** タブをクリック
2. 左メニューの **Pages** をクリック
3. **Source** の **Branch** で **「main」** を選択
4. **Save** をクリック
5. 数分後、以下のURLでアクセス可能になります:
   ```
   https://[あなたのユーザー名].github.io/hospital-manager/hospital-manager-github.html
   ```

---

### ステップ5: Personal Access Token を作成

1. GitHub右上のプロフィールアイコン → **Settings**
2. 左メニュー最下部の **Developer settings**
3. **Personal access tokens** → **Tokens (classic)**
4. **Generate new token** → **Generate new token (classic)**
5. 以下を設定:
   - **Note**: `Hospital Manager App`
   - **Expiration**: `No expiration`（または好みの期限）
   - **Select scopes**: **`repo`** にチェック
6. **Generate token** をクリック
7. **表示されたトークンをコピー**（後で使います）
   - ⚠️ このトークンは二度と表示されないので、必ずコピーしてください

---

### ステップ6: Webアプリで設定

1. 作成したWebアプリのURLにアクセス:
   ```
   https://[あなたのユーザー名].github.io/hospital-manager/hospital-manager-github.html
   ```

2. **⚙️ 設定** タブで以下を入力:
   - **GitHubユーザー名**: あなたのGitHubユーザー名
   - **リポジトリ名**: `hospital-manager`
   - **Personal Access Token**: ステップ5でコピーしたトークン

3. **💾 設定を保存** をクリック

4. **🔌 接続をテスト** をクリックして、接続を確認

---

## 🎯 v6 新機能について

### 📊 タブ構成（5タブ）

- **🏥 病院一覧**: 病院の検索・表示、都道府県・目的別フィルター
- **👨‍⚕️ 従事者**: 医療従事者の管理（職種・病院リンク）
- **📅 カレンダー**: 予約管理、候補日程から確定への流れ
- **➕ 新規追加**: 病院・従事者・予約の登録（3つのサブタブ）
- **⚙️ 設定**: GitHub連携設定、CSVのエクスポート/インポート

### 🏥 病院管理の拡張機能

**新しい項目**:
- 病床数、ICU病床数、透析室病床数、透析患者数、透析装置更新年度

**フィルター機能**:
- 都道府県×目的フィルター（相互フィルター対応）
- 複数選択で絞り込み可能

### 👨‍⚕️ 医療従事者管理

- 職種の自由設定（ドクター、看護師、臨床工学技士など）
- 病院へのリンク
- 連絡先（電話・メール）
- 外来スケジュール設定（曜日ごとにAM/PM × 3スロット）

### 📅 カレンダー・予約管理

- **月単位の予約カレンダー**：日付をタップすると詳細表示
- **候補日程から確定へ**：候補の予約を確定すると、同じタイトルの他の候補は自動削除
- **予約情報**：タイトル、病院、従事者、日時、ステータス、メモ

### 📤📥 CSV エクスポート/インポート

**エクスポート機能**:
- データをCSV形式でダウンロード
- UTF-8 BOM形式でExcelに完全対応
- mailto: リンク付きで、メール送信も可能

**インポート機能**:
- CSV ファイルをアップロードしてデータ更新
- 自動でGitHubに同期

### 📋 CSVファイル一覧

| ファイル | 用途 | カラム数 |
|---------|------|--------|
| `hospitals.csv` | 病院情報 | 13列 |
| `staff.csv` | 医療従事者 | 7列 |
| `targets.csv` | 訪問目的（ユーザー定義可） | 1列 |
| `jobtypes.csv` | 職種（ユーザー定義可） | 1列 |
| `schedules.csv` | 外来スケジュール | 5列 |
| `appointments.csv` | 予約情報 | 8列 |

---

## 📱 iPhoneで使う方法

### 方法1: Safariで直接アクセス

1. iPhoneのSafariでWebアプリのURLを開く:
   ```
   https://[あなたのユーザー名].github.io/hospital-manager/hospital-manager-github.html
   ```

2. **共有ボタン** → **「ホーム画面に追加」**

3. これでアプリのように使えます！

### 方法2: ブックマーク

1. SafariでURLを開く
2. ブックマークに追加
3. いつでもアクセス可能

---

## 💡 基本的な使い方

### 病院を追加

1. **➕ 新規追加** → **施設** タブ
2. 病院情報を入力（名前、住所、病床数など）
3. **✅ 登録して同期** をクリック
4. 自動的にGitHubに保存されます

### 医療従事者を追加

1. **➕ 新規追加** → **従事者** タブ
2. 従事者の基本情報と所属病院を選択
3. **✅ 登録して同期** をクリック

### 外来スケジュールを設定

1. **👨‍⚕️ 従事者** タブで従事者をタップ
2. スケジュールセクションで曜日・時間帯・スロットを設定
3. スケジュール検索：**🏥 病院一覧** の「スケジュール検索」で確認可能

### 予約を管理

1. **📅 カレンダー** タブで日付をタップ
2. **新規予約** で候補日程を追加
3. 候補から確定に変更すると、同タイトルの他の候補は自動削除
4. 確定した予約がカレンダーに表示されます

### 病院を検索・フィルター

1. **🏥 病院一覧** タブを開く
2. キーワード検索またはフィルター条件を選択
   - **都道府県フィルター**で絞り込み
   - **訪問目的フィルター**で絞り込み
3. リアルタイムで結果が更新されます

### データのエクスポート/インポート

**エクスポート**:
1. **⚙️ 設定** タブで対象ファイルを選択
2. **📥 CSVエクスポート** をクリック
3. ファイルがダウンロード、メール送信も可能

**インポート**:
1. **⚙️ 設定** タブで対象ファイルを選択
2. **📤 CSVインポート** で ファイルを選択
3. データが更新され、自動でGitHubに反映

### データの同期

- **自動**: 新規追加、編集、削除時に自動的にGitHubと同期
- **手動**: 各タブを開き直すと最新データを取得

---

## 🔐 セキュリティについて

### Personal Access Tokenの管理

- トークンはブラウザのローカルストレージに保存されます
- 他人と共有しないでください
- 定期的に更新することをおすすめします

### データの公開範囲

- リポジトリをPublicにした場合、CSVファイルは誰でも閲覧可能です
- 機密情報を含む場合は、リポジトリをPrivateにしてください
  - ただし、GitHub Pagesを使う場合はPublicが必要です
  - Privateで運用する場合は、ローカルでHTMLファイルを開く方法を推奨

---

## ❓ トラブルシューティング

### 「接続に失敗しました」と表示される

- ユーザー名、リポジトリ名が正しいか確認
- Personal Access Tokenが正しいか確認
- トークンの権限に `repo` が含まれているか確認

### データが同期されない

- インターネット接続を確認
- GitHubのリポジトリに7つのCSVファイルが全て存在するか確認
  - `hospitals.csv`, `staff.csv`, `targets.csv`, `jobtypes.csv`, `schedules.csv`, `appointments.csv`
- ブラウザのコンソールでエラーを確認

### CSVインポートが失敗する

- CSVファイルの形式が正しいか確認
- 最初の行がヘッダーになっているか確認（自動処理済み）
- UTF-8エンコーディングを使用しているか確認

### 外来スケジュールが表示されない

- 従事者が病院にリンクされているか確認
- スケジュール編集画面で正しい曜日・時間帯・スロットが設定されているか確認

### 予約の候補と確定が正しく動作しない

- 同じタイトルで複数の候補があるか確認
- 確定に変更すると、他の候補は自動的に削除されます
- 削除されたデータは復元できないため、注意してください

### iPhoneで動作しない

- Safariを使用してください（Chrome非推奨）
- iOSを最新版にアップデート
- プライベートブラウズモードをオフに

---

## 🎉 完成！

これで、PCとiPhoneの両方から同じURLでアクセスして、病院顧客管理ができるようになりました！

データはGitHub上に保存されるため、デバイスを変えても同じデータにアクセスできます。

---

## 📞 サポート

質問や問題があれば、GitHubのIssuesに投稿してください。
